language: python
sudo: required
dist: xenial
python: '3.7'
env:
  global:
  - PYTHONPATH=$TRAVIS_BUILD_DIR:$PYTHONPATH
  - LAMBDA_FUNCTION_NAME=flask-api-proxy-example
  - LAMBDA_RUNTIME=python3.7
  - LAMBDA_ROLE=arn:aws:iam::611162374248:role/service-role/datalync-lambda-service
  - LAMBDA_FUNCTION_CODE_ZIP=dist/flask-api-proxy-example.zip
  - LAMBDA_FUNCTION_HANDLER=lambda_function.lambda_handler
  - AWS_DEFAULT_REGION=us-east-1
  - secure: diWANA72RCcyJnyY9awg+mfgEeUEmeARjDT3QNEC3m5EsCXF4Gd7UGdrKFHpXmn9OPx8JTaK7P25t8jD+coZ2489Sz0WBjQUREZhndoxpyJjdP1GmWxOtP5oSegbFStqYwVtwnlJRScBFu1zY74+2vG2mtvhIPoadj6vYZB9AsjCVfVFw/gXUvfdybGFzn49x7OpfV0gEVBWRd2pMIZ7lbB0qE0QBlHffoAoM6xumEnHf0KKG6PxY0VqtTuQvDO8RxLFdlkIkjEuRM6pbChHppEmQiUfyHFP1YZ4y9KHX2mZID+Wiv1xlUGEUqeaPx2uCSfQcfLhu00nkUgFnvxqrm0NmiBCaSyJbId4pRohY9cv5p6irTVsj2+7FEVO5/gYguYfG/J/X/+rF2hgueQPuspywusTmceENj2yikb3GRxC5wihz1ajzzX2IHzr6zvPskw8WeFC8qRzBVvJ8W2GiHlFPHyhXUd3/a07ISoBcaKHJD/nM1Ae9TXza/GNb10cNXjVvl9RjHAvtYxTP3JZCIu1Vip1G8c1FZn2EyhBAfMEXFqgqCFoEf+0RoedtfVrba/Ao4yeb0kyDYP4f/wHrDkI+CKyL8kAMQEESlgvku2VNyct+0Vn9t2CMEiKT4U1K5RITir+miaBDco5HSthv0EltOrb0o4hpwNQdH81/QA=
  - secure: MR9hK7o+Y5qkHAA8EQW2G1EvI59M4HlnyKvLgvCVWtWkVI8A6R+tkFjqJRdbQOQF0nzGJL/2vopOhJpx2srFHgUk/jd4IJNOhAAfSdSLWoyAoVByoPEdyl2zf3gkNPSAGlIk+2WQJzi46CW5CwGEP13ZSnqldHEOaIKVP0Po8QOgInpHKOyXF5f3DYikX0iA5n0kLX3ZTxVo595jZkSmrM5y2O8AIhZnL8F1K2TsxuHPIsGBvnmIkEqLsiNgvNk8b+vawkaKNw1JDko0LB262beLJr+usvEGhTuiAFaCUHF8E2FeXkPPNgoXiWwHUUTe7isjq0JtDYVbHWdmvwBIi8mdbXkFneGSyZpKrHuYikn3ntNx1ix3sUG6ygE5qx4mwc61YaY5hJOLDIzqFQXoZ68VbFwIhubqVL53A2LS8MYA2nAp0lA9p22kI+LT8dikqZUjv6u33kV/fxe4C/mDDAYzj0NvyqQFoXXtRvMz1l4Z2/8Fz8Fu/2Dmci1ugNNNQ0i7K6+RGXjNE+kovRqSzeH410iuOUiRe9Pz9App5RsnE2OuIAZTx/VwnNfrM6MUkeZiFFL6Ux7JJ1v6EPtV0h8oxNsUSERfzIvf4qPCGD6tfD5yk+o4NkxuOOyCr2wylpVXCsQvtRxXYgvvz1zKTjry2hc722XiI0HySMAx3Yg=
install:
- pip install --requirement requirements.txt
script:
- ls
before_deploy:
- mkdir build
- pip install --requirement requirements.txt --target build
- cp lambda_function.py build/
- mkdir dist
- cd build && zip -r ../dist/flask-api-proxy-example.zip .
- cd ..
deploy:
- provider: script
  skip_cleanup: true
  script: python scripts/setup_lambda.py --function-name=$LAMBDA_FUNCTION_NAME --lambda_alias=dev
    --environment=dev --publish-lambda=true --function-handler=$LAMBDA_FUNCTION_HANDLER
    --function-zip-file=$LAMBDA_FUNCTION_CODE_ZIP --lambda-role=$LAMBDA_ROLE --lambda-runtime=$LAMBDA_RUNTIME
    --s3-build-artifacts-bucket=datalync-test-bucket
  on:
    repo: vamshirapolu/flask-api-proxy-example
    branch: develop

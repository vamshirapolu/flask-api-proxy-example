language: python
sudo: required
dist: xenial
python: '3.7'
env:
  global:
  - PYTHONPATH=$TRAVIS_BUILD_DIR:$PYTHONPATH
  - LAMBDA_FUNCTION_NAME=flask-api-proxy-example
  - LAMBDA_RUNTIME=python3.7
  - LAMBDA_ROLE=arn:aws:iam::611162374248:role/service-role/datalync-lambda-service
  - LAMBDA_FUNCTION_CODE_ZIP=dist/flask-api-proxy-example.zip
  - LAMBDA_FUNCTION_HANDLER=lambda_function.lambda_handler
  - AWS_DEFAULT_REGION=us-east-1
  - secure: HRO4fjmV0ZLX+EuqNnpxFM8mpku0XN6b+sSDJX/NDFwepA94aBJstpyBd8FAWcAPd482WRi1B8EQJFRWdfYEMXXeEGiReeXIYxZHB6NTvU2aOCt0zs7ac4gkD7jaCltMwpHdarlZhtWsBQ3gT7wA1ZBYRTanmEcRZqbkJEen2X+5sUJ5tA3cxeo9nC2BANPOeTYI9opncKzuCSnlBapFD8i7FLQac8R0O/C84p4H2X6vrHu2rnYY5KrhoAD9ZaMcEiSAyShk0E+NgcmJLSow3Hpr4cdWM9o6MRju6becRqAQPXtOsCt7NepcuMrHVZcUBZh8gMp5IN3EWowhMeP+3iSh/8bQZwcAZN0DYKnTsGTgaP+0nm1DuHDcFRTIa2C1CjFx4gjUnwL0OVMWMvzQwwuPlrDT0Y5TM5Y+yCp7up68VHGVhrg/pxz7tW98bE7tubUDq52pD5pAozabjH/DueNPUfXECXQC7vb01KcXqV5psBOGhnMGna4I2Ol+p/z8ILRSj2qJTMlKvZYQCgNSxlI0Nv58i1IvN4fBuLjhHcjYOV6oIuWXiu63oxGj/gte8bxxwdINOJiJsRrCrsfye1l63kwyBSl2sbyAIi567PolD2Dv73Wt6Z9MC13nyGvk1PLeopyyBSkSVBOJnttMeeKPrM/4TMQioUcFYZWiMfg=
  - secure: LtqSzVMWIkPQw9lUhNzPjauHEWEEhkY7P6rrvz+5ITMn6sVZN9HZ23OCkbMG3l44EUUhL4CFnOsNZzrpvknz1KRuLO3EXFmAm1VmuBoRKHm51P+WP+ZMM1caVwgTfwRtG0akTgLLvAbxsaI4MvDbf6pkIz0+g2sDC0SFtXJr8ODrcJ80R+vNodt+Xg9t50kVqjbvhYnZHI5xXkY6sBcPHXMvKNk5tID8YqpWiMT4LmqX3nQo7rjdnQaLGe2hDvc62TWwz0Tcb0qn9VNnmIePHEy3S4uowhOfn3MZbO1j6owgdLZSy2Ryj8jJNm/ovhetrmi+WubEDI1z/cN7Ee0d1p4Pp8PxfeOdx+Bbs07OYXOCo21i5BT80n7ZvwMjScHDm9QeTqK4mKluWBLlZ8pJcHWa+ukOf21Lb/ooLuuJI0hyaeBwVZ5RAKxfdciBVqiK98yk59VJ8vOtQaiiWoRPCicD+Q6owQ8FITYKObITKn1So4ZDocrfRqLNkkD4acMn/OB8rWhbhGMbGb9eoCk3sAegCTlWSOKR4Xa2pujfL6wEhPQnjpSoY4TX5VOK25Xu3q/DG28pWGYZt7KiJsoXyCYR9VL8sEYNOB83sFcwwBQxITfmXd8pj4V7SEX2AYnqBPNmSnC5Gzt5dJm2g+PZ22AnexT9WsqwbnLaYhdxaEA=
install:
- pip install --requirement requirements.txt
script:
- ls
before_deploy:
- mkdir build
- pip install --requirement requirements.txt --target build
- cp lambda_function.py build/
- mkdir dist
- cd build && zip -r ../dist/flask-api-proxy-example.zip .
- cd ..
deploy:
- provider: script
  skip_cleanup: true
  script: python scripts/setup_lambda.py --function-name=$LAMBDA_FUNCTION_NAME --lambda_alias=dev
    --environment=dev --publish-lambda=true --function-handler=$LAMBDA_FUNCTION_HANDLER
    --function-zip-file=$LAMBDA_FUNCTION_CODE_ZIP --lambda-role=$LAMBDA_ROLE --lambda-runtime=$LAMBDA_RUNTIME
    --s3-build-artifacts-bucket=datalync-test-bucket
  on:
    repo: vamshirapolu/flask-api-proxy-example
    branch: develop

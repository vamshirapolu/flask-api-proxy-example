language: python
sudo: required
dist: xenial
python: '3.7'
env:
  global:
  - PYTHONPATH=$TRAVIS_BUILD_DIR:$PYTHONPATH
  - LAMBDA_FUNCTION_NAME=flask-api-proxy-example
  - LAMBDA_RUNTIME=python3.7
  - LAMBDA_ROLE=arn:aws:iam::611162374248:role/service-role/datalync-lambda-service
  - LAMBDA_FUNCTION_CODE_ZIP=dist/flask-api-proxy-example.zip
  - LAMBDA_FUNCTION_HANDLER=lambda_function.lambda_handler
  - AWS_DEFAULT_REGION=us-east-1
  - secure: d/mnAMJb/f/nXdjlUQpcYnOkkz6rE81dhCkc7aoiOPjbrfuJUMOHnmhl68aPpOV0c7QDlho0j4CjOZnYcZaRlNfmwIoMrE+EJOUWYyeoHSqq6xYVAMw8IqR4dNXs5LDWI2GE4B7SlStdRAqbEK6WledmuFMouJsOT9iBmTzB8FLAlN1+qrEQmw/ZJGpWLLB5Ty0cim/s6NgBZn7VcLtZrjuUBNfiBtWFl9fBwvBe0JvaqP4VuF3G6ir4biv5jcv8CfWiIbmyOaDQBF/oGOqxIldkdd6XSn90vpoz3rsImd0UANjC7nc0gsb8VZYHIK+2AfYv36zvLHE1//urp8xFOErum65GlCvcaCQ27V0l+cUKd3nnLJf0SEnHKCT5PeWLXtVqCg4zhE+9QHxrKRTrRtGpoxF82kqy+bOexET5KYgS2ohQ1Mo6Ixo3rcJVdleJEp1ucc5EUQvEWNVism6iqe7YzsO3IRmsUSjUoprClQiIIdZWO7ylTUduElHNecFWqeT+GqRAJgpkJKtYCyBeSsLCpSkLjqdf7Y8EuKytDx0uNDLxiO1PP9iR1QDIpZ1++V/i+vnJ4by5A1edR9G+ObkC/j78rWjKfxdtQHvdWQcMUp/dql73RRP2dkz9lIxgNh1MSRqtL4PpDIb6eKaKW4L4gioP30VJIavO/ow1jM0=
  - secure: JuZlrWiChOBI70shfUya+WTfy92Ww0hbNzAvFvb4WnC0iidN9vIXWQqMn1tUu2yeaXifdwpN7Qhk2fqovPQJ2TGjeIGklfrq2mRQfjs3bqdiNwGKhAAihyu3ZkkoV5HscQMbVNS8aJt2E75oY1LCwclDzFZhzfu7Tn+YdDIfOdhOp/bHhqgSlu0Cv1opy0HHA5p5JJ2dgGdaOBzWPy9tt7K3aY0MhQHSuWhzu/ffHbFhFMtXJgwsA/VuaP2G+EB2mC0BTig2LWsfXrr9AB0usn4mNF7e8+HjtFwLdjsnuz7oHDvrPodXl6lAnBx5UH2AVmyEpOYY8mz9VMzMlM3RJJzu2m4V8QRbMjX6gEFv1YUIamrimzCzRCkS7y50p4XPR3I79DHQnWnIHd11b5EXQ8vfZkBGnNpRCAKWpWfTm2xa8XWi2SzBqMCCdOHYFWY4cKBe7o/ywWZki/1uLpEHA5QUUT2hFl7p76BmKiyxGgqra7244tkkChs4eqj+RfCPGiMUCTcZ3hMmnocppkw/iku0dCRxKq6cmXxZqPUCdH990qc4S199xi7XpONjKqxgA71yrizmr2P3393YAfZVEaScjeSA4HqLUie6CtS1Rhls2/jIBpvmMKzilS5zEohdobLfjMmEu0mSDzBzG6mhcQEsToKxzKuDkOi1Rvb8ssY=
install:
- pip install --requirement requirements.txt
script:
- ls
before_deploy:
- mkdir build
- pip install --requirement requirements.txt --target build
- cp lambda_function.py build/
- mkdir dist
- cd build && zip -r ../dist/flask-api-proxy-example.zip .
- cd ..
deploy:
- provider: script
  skip_cleanup: true
  script: python scripts/setup_lambda.py --function-name=$LAMBDA_FUNCTION_NAME --lambda_alias=dev
    --environment=dev --publish-lambda=true --function-handler=$LAMBDA_FUNCTION_HANDLER
    --function-zip-file=$LAMBDA_FUNCTION_CODE_ZIP --lambda-role=$LAMBDA_ROLE --lambda-runtime=$LAMBDA_RUNTIME
    --s3-build-artifacts-bucket=datalync-test-bucket
  on:
    repo: vamshirapolu/flask-api-proxy-example
    branch: develop
